<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Guangzhou Doral Cosmetics Co., Ltd.</title>
    <link href="//unpkg.com/layui@2.9.13/dist/css/layui.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">
</head>
<body>

<div>



    <!-- 商品列表-->
    <div id="ID-productContainer" class="layui-hide">
        <div>
            <fieldset class="layui-elem-field layui-field-title">
                <legend>Category</legend>
            </fieldset>
        </div>
        <div class="my-product-category" id="ID-productCategory">
        </div>
        <div id="ID-productList">
        </div>
    </div>

    <div id="ID-productDetail" class="layui-hide">
        <div class="layui-row" >
            <div class="layui-col-xs12 layui-col-sm12 layui-col-md5 layui-col-lg4 layui-col-lg-offset2 layui-col-md-offset1">
                <div id="ID-carousel-container" class="my-commodity-image-carousel">
                    <div class="layui-carousel" id="ID-carousel-image" style="width: 100%;height: 100%">
                        <div carousel-item id="ID-carousel-image-list"  style="width: 100%;height: 100%">

                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-col-xs12 layui-col-sm12 layui-col-md5 layui-col-lg4">
                <div>
                    <div class="my-product-detail layui-text">
                        <h2 id="ID-productTitle"></h2>
                        <h3 style="margin-top: 16px">Price：<span class="my-price" id="ID-price"></span></h3>
                        <div style="white-space: pre-line;width: 100%">
                            <p id="ID-detail"></p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>


</div>


<script id="ID-productItem" type="text/html">
    <div>
        <fieldset class="layui-elem-field layui-field-title" id="{{d.category}}">
            <legend>{{d.category}}</legend>
        </fieldset>
    </div>
    {{# if(d.data.length !== 0){ }}
    <div class="layui-row layui-col-space14 my-margin8">
        {{# layui.each(d.data, function(index, item){ }}
        <div class="layui-col-xs6 layui-col-sm4 layui-col-md2 layui-col-lg2 my-shop"
             onclick="changeFrameSrc('product.html?id={{item.id}}')">
            <img alt="" src="{{item.img[0]}}"/>
            <h3>{{item.title}}</h3>
<!--            <h4>Price：<span class="my-price">{{item.price}}</span></h4>-->
        </div>
        {{# }); }}
    </div>
    {{# } }}
    {{# if(d.data.length === 0){ }}
    <p class="my-product-no-data">No Data</p>
    {{# } }}
</script>

<script id="ID-productCategoryItem" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
<!--    <a href="#{{item}}">{{item}}</a>-->
    <a lay-on="toProduct">{{item}}</a>
    {{#  }); }}
</script>

<script id="ID-carouselItem" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <div lay-on="openImage" data-index="{{index}}" data-id="{{item}}" style="cursor: pointer;"><img style="object-fit: scale-down;width: 100%;height: 100%;" alt="" src="{{item}}"/></div>
    {{#  }); }}

</script>


<script src="//unpkg.com/layui@2.9.13/dist/layui.js"></script>
<script src="js/index.js"></script>
<script src="js/data.js"></script>
<script>
    layui.use(function () {
        const carousel = layui.carousel;
        const laytpl = layui.laytpl;
        const util = layui.util;
        const device = layui.device();
        const layer = layui.layer;

        const productContainer = $("#ID-productContainer");
        const productDetail = $("#ID-productDetail");

        const productId = layui.url().search.id;

        if (productId) {
            productDetail.removeClass("layui-hide")

            let showProduct = data.productList.find(item => {
                return item.id === parseInt(productId);
            });

            $("#ID-productTitle").text(showProduct.title);
            $("#ID-price").text(showProduct.price);
            $("#ID-detail").text(showProduct.detail)

            renderCarousel(showProduct.img)


        } else {
            productContainer.removeClass("layui-hide")
        }

        if (!isMobileDevice()) {
            productDetail.addClass("my-margin-top16")
        }


        renderCategory();

        renderProduct()

        function renderCategory() {
            const productCategoryItemTpl = $('#ID-productCategoryItem').html();
            const elemView = $('#ID-productCategory');

            // 渲染并输出结果
            laytpl(productCategoryItemTpl).render(data.category, function (str) {
                elemView.html(str);
            });
        }

        function renderProduct() {
            const productItemTpl = $('#ID-productItem').html();
            const elemView = $('#ID-productList');
            for (let i = 0; i < data.category.length; i++) {
                const category = data.category[i];
                const productList = data.productList.filter(item => item.category === category);
                // 渲染并输出结果
                laytpl(productItemTpl).render({category: category, data: productList}, function (str) {
                    elemView.append(str);
                });
            }
        }

        function renderCarousel(imageList) {


            const carouselItemTpl = $('#ID-carouselItem').html(); // 获取模板字符
            const elemView = $('#ID-carousel-image-list'); // 视图对象



            // 渲染并输出结果
            laytpl(carouselItemTpl).render(imageList, function (str) {
                elemView.html(str);
            });
            carousel.render({
                elem: '#ID-carousel-image',
                width: '100%',
                height: '100%',
                interval: 5000,
                trigger: (device.ios || device.android) ? 'click' : 'hover'
            });
        }

        // 打开图片预览
        function openImage(start, imgList) {
            layer.photos({
                photos: {
                    "title": "Photos View",
                    "start": start,
                    "data": imgList
                },
                success: function () {
                    // 切换为英文
                    $(".layui-layer-photos-toolbar").find('[title="变换"]').attr('title',"Transform");
                    $(".layui-layer-photos-toolbar").find('[title="放大"]').attr('title',"Zoom In");
                    $(".layui-layer-photos-toolbar").find('[title="缩小"]').attr('title',"Zoom Out");
                    $(".layui-layer-photos-toolbar").find('[title="还原"]').attr('title',"Reset");
                    $(".layui-layer-photos-toolbar").find('[title="关闭"]').attr('title',"Close");
                },
            });
        }

        util.on('lay-on', {
            openImage: function () {
                 const carouselContainer = $(this);
                 const index = carouselContainer.attr('data-index');

                const imgList = carouselContainer.parent().find("img").map((it,img) =>{
                    return {
                        alt: '',
                        pid: it,
                        src: img.src
                    }
                });

                openImage(index,imgList)
            },
            'toProduct': function () {
                document.getElementById($(this).html()).scrollIntoView({behavior: 'smooth'})
            },
        })


    })
</script>
</body>
</html>